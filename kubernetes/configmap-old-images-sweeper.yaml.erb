apiVersion: v1
kind: ConfigMap
metadata:
  namespace: ops
  name: old-images-sweeper
  labels:
    app: old-images-sweeper
data:
  sweeper.yaml: |
    image_registries:
      - name: artifactory
        driver: login
        prefix: ***REMOVED***:6555
        config:
          username_var: ARTIFACTORY_USERNAME
          password_var: ARTIFACTORY_PASSWORD
      - name: aws
        driver: aws
        prefix: ***REMOVED***
        config:
          region: us-west-2
      - name: local
        driver: noop
        prefix: local-registry
      - name: gcp
        driver: gcp
        prefix: ***REMOVED***
    sweeper:
      - repository: kubernetes-snapshot-local
        prefixes:
          # first to match wins, so PRs always get the 14 day retention
          - pattern: "*_prs"
            retention: 14d
          - pattern: "*_branches_*"
            retention: 14d
          - pattern: "*/PR-*"
            retention: 14d
            # DEV-836/OPS-10268:
            # For artifacts generated from PR Jenkins Jobs,
            # we only run this scheduled sweeper as configured above.
            # For artifacts generated from master Jenkins Jobs,
            # builds will run `kdt sweeper` for that Job
            # after the build succeeds.
