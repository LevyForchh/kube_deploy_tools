#!/usr/bin/env ruby
# Script that cleans out old containers and artifactory objects

require 'optparse'

require 'kube_deploy_tools/formatted_logger'
require 'kube_deploy_tools/shellrunner'
require 'kube_deploy_tools/sweeper'

KubeDeployTools::Logger.logger = KubeDeployTools::FormattedLogger.build
KubeDeployTools::Shellrunner.shellrunner = KubeDeployTools::Shellrunner.new

# Read args for info on what to change/customize
options = {}

OptionParser.new do |opts|
  opts.on('-d', '--dryrun', 'Dryrun') do |d|
    options[:dryrun] = true
  end
  opts.on('-f', '--file file', 'Config file path') do |file|
    options[:file] = file
  end
end.parse!

config_file_path = options['file'] || ARGV[0]
dryrun = options['dryrun'] || false

KubeDeployTools::Sweeper.new(config_file_path, dryrun).remove_images
