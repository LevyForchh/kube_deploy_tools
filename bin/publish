#!/usr/bin/env ruby

require 'optparse'

require 'kube_deploy_tools/publish'
require 'kube_deploy_tools/publish/options'

require 'kube_deploy_tools/formatted_logger'
require 'kube_deploy_tools/shellrunner'

def options
  $options ||= begin
    parser = KubeDeployTools::Publish::Optparser.new
    parser.parse(ARGV)
  end
end

KubeDeployTools::Logger.logger = KubeDeployTools::FormattedLogger.build
KubeDeployTools::Shellrunner.shellrunner = KubeDeployTools::Shellrunner.new

KubeDeployTools::Publish.new(
  manifest: options.manifest_file,
  output_dir: options.output_path,
).publish
